/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{376:function(ha,ca,f){f.r(ca);var aa=f(4),x=f(12),fa=f(1);ha=f(43);var da=f(31),ba=f(10);f=function(){function f(){this.init()}f.prototype.init=function(){this.b0=!1;this.Wf=this.nk=this.connection=null;this.uq={};this.ea=this.fC=null};f.prototype.bea=function(f){for(var n=this,h=0;h<f.length;++h){var e=f[h];switch(e.at){case "create":this.uq[e.author]||(this.uq[e.author]=e.aName);this.N6(e);break;case "modify":this.ea.Km(e.xfdf).then(function(e){n.ea.rb(e[0])});
break;case "delete":this.ea.Km("<delete><id>"+e.aId+"</id></delete>")}}};f.prototype.N6=function(f){var n=this;this.ea.Km(f.xfdf).then(function(h){h=h[0];h.authorId=f.author;n.ea.rb(h);n.ea.trigger(x.a.UPDATE_ANNOTATION_PERMISSION,[h])})};f.prototype.p6=function(f,n,h){this.nk&&this.nk(f,n,h)};f.prototype.preloadAnnotations=function(f){this.addEventListener("webViewerServerAnnotationsEnabled",this.p6.bind(this,f,"add",{imported:!1}),{once:!0})};f.prototype.initiateCollaboration=function(r,n,h){var e=
this;if(r){e.Wf=n;e.ea=h.va();h.addEventListener(x.c.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.Bea(r);var w=new XMLHttpRequest;w.addEventListener("load",function(){if(200===w.status&&0<w.responseText.length)try{var h=JSON.parse(w.responseText);e.connection=exports.lb.bfa(Object(da.i)(e.Wf,"blackbox/"),"annot");e.fC=h.id;e.uq[h.id]=h.user_name;e.ea.EI(h.id);e.connection.iJ(function(f){f.t&&f.t.startsWith("a_")&&f.data&&e.bea(f.data)},function(){e.connection.send({t:"a_retrieve",dId:r});
e.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.uq[h.id],e.fC])},function(){e.disableCollaboration()})}catch(ia){Object(fa.f)(ia.message)}});w.open("GET",Object(da.i)(this.Wf,"demo/SessionInfo.jsp"));w.withCredentials=!0;w.send();e.b0=!0;e.ea.sT(function(f){return e.uq[f.Author]||f.Author})}else Object(fa.f)("Document ID required for collaboration")};f.prototype.disableCollaboration=function(){this.nk&&(this.ea.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.nk),this.nk=null);this.connection&&
this.connection.bF();this.ea&&this.ea.EI("Guest");this.init();this.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};f.prototype.Bea=function(f){var n=this;this.nk&&this.ea.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.nk);this.nk=function(h,e,r){return Object(aa.b)(this,void 0,void 0,function(){var w,x,y,ba,da,ca,fa,ha,ra;return Object(aa.d)(this,function(z){switch(z.label){case 0:if(r.imported)return[2];w={t:"a_"+e,dId:f,annots:[]};return[4,n.ea.nO()];case 1:x=z.oa();"delete"!==
e&&(y=(new DOMParser).parseFromString(x,"text/xml"),ba=new XMLSerializer);for(da=0;da<h.length;da++)ca=h[da],ha=fa=void 0,"add"===e?(fa=y.querySelector('[name="'+ca.Id+'"]'),ha=ba.serializeToString(fa),ra=null,ca.InReplyTo&&(ra=n.ea.qg(ca.InReplyTo).authorId||"default"),w.annots.push({at:"create",aId:ca.Id,author:n.fC,aName:n.uq[n.fC],parent:ra,xfdf:"<add>"+ha+"</add>"})):"modify"===e?(fa=y.querySelector('[name="'+ca.Id+'"]'),ha=ba.serializeToString(fa),w.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>"+
ha+"</modify>"})):"delete"===e&&w.annots.push({at:"delete",aId:ca.Id});0<w.annots.length&&n.connection.send(w);return[2]}})})}.bind(n);this.ea.addEventListener(ba.a.Events.ANNOTATION_CHANGED,this.nk)};f.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return f}();Object(ha.a)(f);ca["default"]=f}}]);}).call(this || window)
